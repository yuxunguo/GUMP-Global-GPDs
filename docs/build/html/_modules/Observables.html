<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Observables &mdash; GUMP GPD Analysis 0.5.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=1dd76d02"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            GUMP GPD Analysis
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">GUMP-Global-GPDs</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">GUMP GPD Analysis</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Module code</a></li>
      <li class="breadcrumb-item active">Observables</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for Observables</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Here we define the GPD ansatz based on the moment space expression norm * x^ alpha  * (1-x)^ beta.</span>
<span class="sd">With the GPDs ansatz, observables with LO evolution are calculated</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">scipy</span> <span class="k">as</span> <span class="nn">sp</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">mpmath</span> <span class="kn">import</span> <span class="n">mp</span><span class="p">,</span> <span class="n">hyp2f1</span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">quad_vec</span><span class="p">,</span> <span class="n">fixed_quad</span>
<span class="kn">from</span> <span class="nn">scipy.special</span> <span class="kn">import</span> <span class="n">gamma</span>
<span class="kn">from</span> <span class="nn">Evolution</span> <span class="kn">import</span> <span class="n">Moment_Evo_LO</span><span class="p">,</span><span class="n">TFF_Evo_LO</span><span class="p">,</span> <span class="n">CFF_Evo_LO</span><span class="p">,</span> <span class="n">TFF_Evo_NLO_evWC</span><span class="p">,</span> <span class="n">TFF_Evo_NLO_evMOM</span><span class="p">,</span> <span class="n">GPD_Moment_Evo_NLO</span><span class="p">,</span><span class="n">tPDF_Moment_Evo_NLO</span><span class="p">,</span> <span class="n">fixed_quadvec</span><span class="p">,</span> <span class="n">inv_flav_trans</span>
<span class="kn">from</span> <span class="nn">Parameters</span> <span class="kn">import</span> <span class="n">Moment_Sum</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">***********************GPD moments***************************************</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c1">#intercept for inverse Mellin transformation</span>
<span class="n">inv_Mellin_intercept</span> <span class="o">=</span> <span class="mf">0.25</span>

<span class="c1">#Cutoff for inverse Mellin transformation</span>
<span class="n">inv_Mellin_cutoff</span> <span class="o">=</span> <span class="mi">20</span>

<span class="c1">#Cutoff for Mellin Barnes integral</span>
<span class="n">Mellin_Barnes_intercept</span> <span class="o">=</span> <span class="mf">0.3</span>

<span class="c1">#Cutoff for Mellin Barnes integral</span>
<span class="n">Mellin_Barnes_cutoff</span> <span class="o">=</span> <span class="mi">20</span>

<span class="c1">#Number of effective fermions</span>
<span class="n">NFEFF</span> <span class="o">=</span> <span class="mi">2</span>

<span class="c1">#Relative precision Goal of quad set to be 1e-3</span>
<span class="n">Prec_Goal</span> <span class="o">=</span> <span class="mf">1e-3</span>


<div class="viewcode-block" id="flv_to_indx">
<a class="viewcode-back" href="../Observables.html#Observables.flv_to_indx">[docs]</a>
<span class="k">def</span> <span class="nf">flv_to_indx</span><span class="p">(</span><span class="n">flv</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    flv is the flavor. It is a string</span>

<span class="sd">    This function will cast each flavor to an auxiliary length 3 array</span>

<span class="sd">    Output shape: scalar int    </span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">flv</span><span class="o">==</span><span class="s2">&quot;u&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">if</span><span class="p">(</span><span class="n">flv</span><span class="o">==</span><span class="s2">&quot;d&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">if</span><span class="p">(</span><span class="n">flv</span><span class="o">==</span><span class="s2">&quot;g&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">2</span>
    <span class="k">if</span><span class="p">(</span><span class="n">flv</span><span class="o">==</span><span class="s2">&quot;NS&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">3</span>
    <span class="k">if</span><span class="p">(</span><span class="n">flv</span><span class="o">==</span><span class="s2">&quot;S&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">4</span></div>


<div class="viewcode-block" id="flvs_to_indx">
<a class="viewcode-back" href="../Observables.html#Observables.flvs_to_indx">[docs]</a>
<span class="k">def</span> <span class="nf">flvs_to_indx</span><span class="p">(</span><span class="n">flvs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;flvs is an array of strings (N)</span>
<span class="sd">    Output: (N)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">output</span> <span class="o">=</span> <span class="p">[</span><span class="n">flv_to_indx</span><span class="p">(</span><span class="n">flv</span><span class="p">)</span> <span class="k">for</span> <span class="n">flv</span> <span class="ow">in</span> <span class="n">flvs</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span></div>


<span class="c1">#The flavor interpreter to return the corresponding flavor combination </span>
<div class="viewcode-block" id="Flv_Intp">
<a class="viewcode-back" href="../Observables.html#Observables.Flv_Intp">[docs]</a>
<span class="k">def</span> <span class="nf">Flv_Intp</span><span class="p">(</span><span class="n">Flv_array</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">flv</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Flv_array: (N, 3) complex</span>
<span class="sd">    flv: (N) str</span>

<span class="sd">    return result: (N) complex</span>
<span class="sd">    &quot;&quot;&quot;</span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    if(flv == &quot;u&quot;):</span>
<span class="sd">        return Flv_array[0]</span>
<span class="sd">    if(flv == &quot;d&quot;):</span>
<span class="sd">        return Flv_array[1]</span>
<span class="sd">    if(flv == &quot;g&quot;):</span>
<span class="sd">        return Flv_array[2]</span>
<span class="sd">    if(flv == &quot;NS&quot;):</span>
<span class="sd">        return Flv_array[0] - Flv_array[1]</span>
<span class="sd">    if(flv == &quot;S&quot;):</span>
<span class="sd">        return Flv_array[0] + Flv_array[1]</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">_flv_index</span> <span class="o">=</span> <span class="n">flvs_to_indx</span><span class="p">(</span><span class="n">flv</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="n">_flv_index</span><span class="p">,</span> <span class="p">[</span><span class="n">Flv_array</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">Flv_array</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">Flv_array</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>\
                        <span class="n">Flv_array</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">Flv_array</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">Flv_array</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">Flv_array</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span></div>

    <span class="c1"># return np.einsum(&#39;...j,...j&#39;, Flv_array, _helper) # (N)</span>
    
<span class="c1"># This is in evolution basis!!!</span>
<div class="viewcode-block" id="flvmask">
<a class="viewcode-back" href="../Observables.html#Observables.flvmask">[docs]</a>
<span class="k">def</span> <span class="nf">flvmask</span><span class="p">(</span><span class="n">flv</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">flv</span> <span class="o">==</span> <span class="s1">&#39;All&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">flv</span> <span class="o">==</span> <span class="s1">&#39;g&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">flv</span> <span class="o">==</span> <span class="s1">&#39;q&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span></div>

    
<span class="c1"># precision for the hypergeometric function</span>
<span class="n">mp</span><span class="o">.</span><span class="n">dps</span> <span class="o">=</span> <span class="mi">25</span>

<span class="n">hyp2f1_nparray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frompyfunc</span><span class="p">(</span><span class="n">hyp2f1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

<div class="viewcode-block" id="InvMellinWaveFuncQ">
<a class="viewcode-back" href="../Observables.html#Observables.InvMellinWaveFuncQ">[docs]</a>
<span class="k">def</span> <span class="nf">InvMellinWaveFuncQ</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="nb">complex</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">complex</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Quark wave function for inverse Mellin transformation: x^(-s) for x&gt;0 and 0 for x&lt;0</span>

<span class="sd">    Args:</span>
<span class="sd">        s: Mellin moment s (= n)</span>
<span class="sd">        x: momentum fraction x</span>

<span class="sd">    Returns:</span>
<span class="sd">        Wave function for inverse Mellin transformation: x^(-s) for x&gt;0 and 0 for x&lt;0</span>

<span class="sd">    vectorized version of InvMellinWaveFuncQ</span>
<span class="sd">    &quot;&quot;&quot;</span> 

<span class="w">    </span><span class="sd">&#39;&#39;&#39; </span>
<span class="sd">    if(x &gt; 0):</span>
<span class="sd">        return x ** (-s)</span>
<span class="sd">    </span>
<span class="sd">    return 0</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">s</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span></div>



<div class="viewcode-block" id="InvMellinWaveFuncG">
<a class="viewcode-back" href="../Observables.html#Observables.InvMellinWaveFuncG">[docs]</a>
<span class="k">def</span> <span class="nf">InvMellinWaveFuncG</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="nb">complex</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">complex</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Gluon wave function for inverse Mellin transformation: x^(-s+1) for x&gt;0 and 0 for x&lt;0</span>

<span class="sd">    Args:</span>
<span class="sd">        s: Mellin moment s (= n)</span>
<span class="sd">        x: momentum fraction x</span>

<span class="sd">    Returns:</span>
<span class="sd">        Gluon wave function for inverse Mellin transformation: x^(-s+1) for x&gt;0 and 0 for x&lt;0</span>
<span class="sd">    &quot;&quot;&quot;</span>  

<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    if(x &gt; 0):</span>
<span class="sd">        return x ** (-s+1)</span>
<span class="sd">    </span>
<span class="sd">    return 0</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">s</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span></div>


<div class="viewcode-block" id="ConfWaveFuncQ">
<a class="viewcode-back" href="../Observables.html#Observables.ConfWaveFuncQ">[docs]</a>
<span class="k">def</span> <span class="nf">ConfWaveFuncQ</span><span class="p">(</span><span class="n">j</span><span class="p">:</span> <span class="nb">complex</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">xi</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">complex</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Quark conformal wave function p_j(x,xi) </span>
<span class="sd">    </span>
<span class="sd">    Check e.g. https://arxiv.org/pdf/hep-ph/0509204.pdf</span>

<span class="sd">    Args:</span>
<span class="sd">        j: conformal spin j (conformal spin is actually j+2 but anyway)</span>
<span class="sd">        x: momentum fraction x</span>
<span class="sd">        xi: skewness parameter xi</span>

<span class="sd">    Returns:</span>
<span class="sd">        quark conformal wave function p_j(x,xi)</span>
<span class="sd">    &quot;&quot;&quot;</span>  

    <span class="n">pDGLAP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">xi</span><span class="p">,</span>                <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">hyp2f1_nparray</span><span class="p">(</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">5</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">xi</span><span class="o">/</span><span class="n">x</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span> <span class="nb">complex</span><span class="p">)</span>                           <span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">pERBL</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(((</span><span class="n">x</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">xi</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">xi</span><span class="p">)),</span> <span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">j</span><span class="p">)</span> <span class="o">*</span> <span class="n">gamma</span><span class="p">(</span><span class="mi">5</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">j</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">gamma</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">gamma</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">j</span><span class="p">))</span> <span class="o">*</span> <span class="n">xi</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">x</span><span class="o">/</span><span class="n">xi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">hyp2f1_nparray</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">j</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">xi</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">xi</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span> <span class="nb">complex</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">pDGLAP</span> <span class="o">+</span> <span class="n">pERBL</span></div>



<div class="viewcode-block" id="ConfWaveFuncG">
<a class="viewcode-back" href="../Observables.html#Observables.ConfWaveFuncG">[docs]</a>
<span class="k">def</span> <span class="nf">ConfWaveFuncG</span><span class="p">(</span><span class="n">j</span><span class="p">:</span> <span class="nb">complex</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">xi</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">complex</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gluon conformal wave function p_j(x,xi) </span>
<span class="sd">    </span>
<span class="sd">    Check e.g. https://arxiv.org/pdf/hep-ph/0509204.pdf</span>

<span class="sd">    Args:</span>
<span class="sd">        j: conformal spin j (actually conformal spin is j+2 but anyway)</span>
<span class="sd">        x: momentum fraction x</span>
<span class="sd">        xi: skewness parameter xi</span>

<span class="sd">    Returns:</span>
<span class="sd">        gluon conformal wave function p_j(x,xi)</span>
<span class="sd">    &quot;&quot;&quot;</span> 
    <span class="c1"># An extra minus sign defined different from the orginal definition to absorb the extra minus sign of MB integral for gluon</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Minus = -1</span>
<span class="sd">    if(x &gt; xi):</span>
<span class="sd">        pDGLAP = np.sin(np.pi * j)/ np.pi * x**(-j) * complex(hyp2f1( j/2, (j+1)/2, j+5/2, (xi/x) ** 2)) </span>
<span class="sd">        return Minus * pDGLAP</span>

<span class="sd">    if(x &gt; -xi):</span>
<span class="sd">        pERBL = 2 ** j * gamma(5/2+j) / (gamma(1/2) * gamma(j)) * xi ** (-j) * (1+x/xi) ** 2 * complex(hyp2f1(-1-j,j+2,3, (x+xi)/(2*xi)))</span>
<span class="sd">        return Minus * pERBL</span>
<span class="sd">    </span>
<span class="sd">    return 0</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Minus</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

    <span class="n">pDGLAP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">xi</span><span class="p">,</span>                <span class="n">Minus</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">j</span><span class="p">)</span><span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">j</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">hyp2f1_nparray</span><span class="p">(</span> <span class="n">j</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">5</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">xi</span><span class="o">/</span><span class="n">x</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span> <span class="nb">complex</span><span class="p">)</span>                                   <span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">pERBL</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(((</span><span class="n">x</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">xi</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">xi</span><span class="p">)),</span> <span class="n">Minus</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">j</span> <span class="o">*</span> <span class="n">gamma</span><span class="p">(</span><span class="mi">5</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">j</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">gamma</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">gamma</span><span class="p">(</span><span class="n">j</span><span class="p">))</span> <span class="o">*</span> <span class="n">xi</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="n">j</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">x</span><span class="o">/</span><span class="n">xi</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">hyp2f1_nparray</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">j</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">xi</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">xi</span><span class="p">))),</span> <span class="n">dtype</span><span class="o">=</span> <span class="nb">complex</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">pDGLAP</span> <span class="o">+</span> <span class="n">pERBL</span></div>


<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">***********************Observables***************************************</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># Class for observables</span>
<div class="viewcode-block" id="GPDobserv">
<a class="viewcode-back" href="../Observables.html#Observables.GPDobserv">[docs]</a>
<span class="k">class</span> <span class="nc">GPDobserv</span> <span class="p">(</span><span class="nb">object</span><span class="p">)</span> <span class="p">:</span>
    <span class="c1">#Initialization of observables. Each is a function of (x, xi ,t, Q), p for parity: p = 1 for vector GPDs (H, E) and p = -1 for axial-vector GPDs (Ht, Et)</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">init_x</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">init_xi</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">init_t</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">init_Q</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">init_x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xi</span> <span class="o">=</span> <span class="n">init_xi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="n">init_t</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Q</span> <span class="o">=</span> <span class="n">init_Q</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">p</span>

<div class="viewcode-block" id="GPDobserv.tPDF">
<a class="viewcode-back" href="../Observables.html#Observables.GPDobserv.tPDF">[docs]</a>
    <span class="k">def</span> <span class="nf">tPDF</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flv</span><span class="p">,</span> <span class="n">ParaAll</span><span class="p">,</span> <span class="n">p_order</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;t-denpendent PDF for given flavor (flv = &quot;u&quot;, &quot;d&quot;, &quot;S&quot;, &quot;NS&quot; or &quot;g&quot;)</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            ParaAll = [Para_Forward, Para_xi2]</span>
<span class="sd">            Para_Forward = [Para_Forward_uV, Para_Forward_ubar, Para_Forward_dV, Para_Forward_dbar, Para_Forward_g]</span>
<span class="sd">            Para_Forward_i: parameter sets for valence u quark (uV), sea u quark (ubar), valence d quark (dV), sea d quark (dbar) and gluon (g)</span>
<span class="sd">            Para_xi2: only matter for non-zero xi (NOT needed here but the parameters are passed for consistency with GPDs)</span>
<span class="sd">            </span>
<span class="sd">            p_order: 1 for leading-order evolution (default); 2 for next-to-leading-order evolution ; higher order not implemented yet</span>

<span class="sd">        Returns:</span>
<span class="sd">            f(x,t) in for the given flavor</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># originally, all parameters should be (4, 3, 5, 1, 5)</span>
        <span class="c1"># ParaAll would be a ( 3, 5, 1, 5) matrix</span>
        <span class="c1"># this means Para_Forward would be a matrix of (5, 1, 5)</span>

        <span class="c1"># For now, I will pass ParaAll as (N, 3, 5, 1, 5) array</span>
        <span class="c1"># This is not optimal for performance, but it somewhat retains backwards compatibility</span>
        <span class="c1"># For better speed, more changes are needed. </span>

        <span class="n">Para_Forward</span> <span class="o">=</span> <span class="n">ParaAll</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="c1"># (N, 3, 5, 1, 5) </span>

        <span class="k">def</span> <span class="nf">InvMellinWaveConf</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="nb">complex</span><span class="p">):</span>
            <span class="c1"># s is scalar (but it actually can be an ndarray as long as broadcasting rule allows it)</span>

<span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            InvMellinWaveC = np.array([[InvMellinWaveFuncQ(s, self.x), InvMellinWaveFuncQ(s, self.x) - self.p * InvMellinWaveFuncQ(s, -self.x),0,0,0],</span>
<span class="sd">                                       [0,0,InvMellinWaveFuncQ(s, self.x), InvMellinWaveFuncQ(s, self.x) - self.p * InvMellinWaveFuncQ(s, -self.x),0],</span>
<span class="sd">                                       [0,0,0,0,(InvMellinWaveFuncG(s, self.x)+ self.p * InvMellinWaveFuncG(s, -self.x))]]) # (3, 5) matrix</span>
<span class="sd">                                       # in my case, I want it to be (N, 3, 5) ndarray</span>
<span class="sd">            &#39;&#39;&#39;</span>

            <span class="c1"># InvMellinWaveFuncQ(s, self.x) # shape (N)</span>
            <span class="c1"># self.p * InvMellinWaveFuncQ(s, -self.x) # shape (N)</span>

            <span class="n">helper1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
            <span class="n">helper2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
            <span class="n">helper3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>

            <span class="n">InvMellinWaveC</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;..., ij-&gt;...ij&#39;</span><span class="p">,</span> <span class="n">InvMellinWaveFuncQ</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">),</span> <span class="n">helper1</span><span class="p">)</span> \
                            <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;... ,ij-&gt;...ij&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">*</span> <span class="n">InvMellinWaveFuncQ</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">),</span> <span class="n">helper2</span><span class="p">)</span> \
                            <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;... ,ij-&gt;...ij&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">InvMellinWaveFuncG</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span><span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">*</span> <span class="n">InvMellinWaveFuncG</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)),</span> <span class="n">helper3</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">InvMellinWaveC</span> <span class="c1">#(N, 3, 5)</span>

        <span class="k">def</span> <span class="nf">Integrand_inv_Mellin</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="nb">complex</span><span class="p">):</span>
            <span class="c1"># Calculate the unevolved moments in the orginal flavor basis</span>
            <span class="c1"># originally, Para_Forward will have shape (5, 1, 5) now (N, 5, 1, 5)  # in previous version is is (5, 1, 4) and (N, 5, 1, 4)           </span>

            <span class="n">ConfFlav</span> <span class="o">=</span> <span class="n">Moment_Sum</span><span class="p">(</span><span class="n">s</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">Para_Forward</span><span class="p">)</span> <span class="c1"># shape (N, 5)</span>

            <span class="c1"># Evolved moments in evolution basis</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">p_order</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">ConfEv</span> <span class="o">=</span> <span class="n">Moment_Evo_LO</span><span class="p">(</span><span class="n">s</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">NFEFF</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">,</span> <span class="n">ConfFlav</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">p_order</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
                <span class="n">ConfEv</span> <span class="o">=</span> <span class="n">tPDF_Moment_Evo_NLO</span><span class="p">(</span><span class="n">s</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">NFEFF</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">,</span> <span class="n">ConfFlav</span><span class="p">)</span>
            
            <span class="c1"># Inverse transform the evolved moments back to the flavor basis</span>
            <span class="n">EvoConfFlav</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;...ij, ...j-&gt;...i&#39;</span><span class="p">,</span> <span class="n">inv_flav_trans</span><span class="p">,</span> <span class="n">ConfEv</span><span class="p">)</span> <span class="c1">#(N, 5)</span>
    
            <span class="c1"># Return the evolved moments with x^(-s) for quark or x^(-s+1) for gluon for the given flavor flv = &quot;u&quot;, &quot;d&quot;, &quot;S&quot;, &quot;NS&quot; or &quot;g&quot;</span>
            <span class="c1">#  InvMellinWaveConf(s): (N, 3, 5)            </span>
            <span class="c1"># the result of np.einsum will be (N, 3)</span>
            <span class="c1"># Flv_Intp  result (N)</span>
            <span class="k">return</span> <span class="n">Flv_Intp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;...ij,...j-&gt;...i&#39;</span><span class="p">,</span> <span class="n">InvMellinWaveConf</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="n">EvoConfFlav</span><span class="p">),</span> <span class="n">flv</span><span class="p">)</span>
        
        <span class="c1"># The contour for inverse Meliin transform. Note that S here is the analytically continued n which is j + 1 not j !</span>
        <span class="n">reS</span> <span class="o">=</span> <span class="mf">0.25</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">Max_imS</span> <span class="o">=</span> <span class="mi">100</span> 
        
        <span class="k">return</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">fixed_quadvec</span><span class="p">(</span><span class="k">lambda</span> <span class="n">imS</span> <span class="p">:</span> <span class="n">Integrand_inv_Mellin</span><span class="p">(</span><span class="n">reS</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">imS</span><span class="p">)</span> <span class="o">+</span> <span class="n">Integrand_inv_Mellin</span><span class="p">(</span><span class="n">reS</span> <span class="o">-</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">imS</span><span class="p">)</span> <span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="o">+</span> <span class="n">Max_imS</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">300</span><span class="p">))</span></div>


<div class="viewcode-block" id="GPDobserv.GPD">
<a class="viewcode-back" href="../Observables.html#Observables.GPDobserv.GPD">[docs]</a>
    <span class="k">def</span> <span class="nf">GPD</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flv</span><span class="p">,</span> <span class="n">ParaAll</span><span class="p">,</span> <span class="n">p_order</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;GPD F(x, xi, t) in flavor space (flv = &quot;u&quot;, &quot;d&quot;, &quot;S&quot;, &quot;NS&quot; or &quot;g&quot;)</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            ParaAll = [Para_Forward, Para_xi2, Para_xi4]</span>
<span class="sd">            Para_Forward = [Para_Forward_uV, Para_Forward_ubar, Para_Forward_dV, Para_Forward_dbar, Para_Forward_g]</span>
<span class="sd">            Para_Forward_i: forward parameter sets for valence u quark (uV), sea u quark (ubar), valence d quark (dV), sea d quark (dbar) and gluon (g)</span>
<span class="sd">            Para_xi2 = [Para_xi2_uV, Para_xi2_ubar, Para_xi2_dV, Para_xi2_dbar, Para_xi2_g]</span>
<span class="sd">            Para_xi2_i: xi^2 parameter sets for valence u quark (uV), sea u quark (ubar), valence d quark (dV), sea d quark (dbar) and gluon (g)</span>
<span class="sd">            Para_xi4 = [Para_xi4_uV, Para_xi4_ubar, Para_xi4_dV, Para_xi4_dbar, Para_xi4_g]</span>
<span class="sd">            Para_xi4_i: xi^4 parameter sets for valence u quark (uV), sea u quark (ubar), valence d quark (dV), sea d quark (dbar) and gluon (g)</span>
<span class="sd">            </span>
<span class="sd">            p_order: 1 for leading-order evolution (default); 2 for next-to-leading-order evolution ; higher order not implemented yet</span>

<span class="sd">        Returns:</span>
<span class="sd">            f(x,xi,t) for given flavor flv</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#[Para_Forward, Para_xi2, Para_xi4] = ParaAll</span>

        <span class="n">Para_Forward</span> <span class="o">=</span> <span class="n">ParaAll</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:]</span>  <span class="c1"># each (N, 5, 1, 5)</span>
        <span class="n">Para_xi2</span>     <span class="o">=</span> <span class="n">ParaAll</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:]</span>
        <span class="n">Para_xi4</span>     <span class="o">=</span> <span class="n">ParaAll</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:]</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        # Removing xi^4 terms</span>
<span class="sd">        Para_xi4     = ParaAll[..., 2, :, :, :]</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c1"># The contour for Mellin-Barnes integral in terms of j not n.         </span>

        <span class="k">def</span> <span class="nf">ConfWaveConv</span><span class="p">(</span><span class="n">j</span><span class="p">:</span> <span class="nb">complex</span><span class="p">):</span>

<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            ConfWaveC = np.array([[ConfWaveFuncQ(j, self.x, self.xi), ConfWaveFuncQ(j, self.x, self.xi) - self.p * ConfWaveFuncQ(j, -self.x, self.xi),0,0,0],</span>
<span class="sd">                                  [0,0,ConfWaveFuncQ(j, self.x, self.xi), ConfWaveFuncQ(j, self.x, self.xi) - self.p * ConfWaveFuncQ(j, -self.x, self.xi),0],</span>
<span class="sd">                                  [0,0,0,0,ConfWaveFuncG(j, self.x, self.xi)+ self.p * ConfWaveFuncG(j, -self.x, self.xi)]])</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="n">helper1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
            <span class="n">helper2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
            <span class="n">helper3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>

            <span class="n">ConfWaveC</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;..., ij-&gt;...ij&#39;</span><span class="p">,</span> <span class="n">ConfWaveFuncQ</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi</span><span class="p">),</span> <span class="n">helper1</span><span class="p">)</span> \
                     <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;... ,ij-&gt;...ij&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">*</span> <span class="n">ConfWaveFuncQ</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi</span><span class="p">),</span> <span class="n">helper2</span><span class="p">)</span> \
                     <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;... ,ij-&gt;...ij&#39;</span><span class="p">,</span> <span class="n">ConfWaveFuncG</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi</span><span class="p">)</span><span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">*</span> <span class="n">ConfWaveFuncG</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi</span><span class="p">),</span> <span class="n">helper3</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">ConfWaveC</span>
        
        <span class="k">def</span> <span class="nf">Integrand_Mellin_Barnes</span><span class="p">(</span><span class="n">j</span><span class="p">:</span> <span class="nb">complex</span><span class="p">):</span>

            <span class="n">ConfFlav</span>     <span class="o">=</span> <span class="n">Moment_Sum</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">Para_Forward</span><span class="p">)</span> <span class="c1">#(N, 5)</span>
            <span class="n">ConfFlav_xi2</span> <span class="o">=</span> <span class="n">Moment_Sum</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">Para_xi2</span><span class="p">)</span>
            <span class="n">ConfFlav_xi4</span> <span class="o">=</span> <span class="n">Moment_Sum</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">Para_xi4</span><span class="p">)</span>
            
            <span class="c1">#Evolve the conformal moments for different p_order</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">p_order</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">ConfEv</span>     <span class="o">=</span> <span class="n">Moment_Evo_LO</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">NFEFF</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">,</span> <span class="n">ConfFlav</span><span class="p">)</span>
                <span class="n">ConfEv_xi2</span> <span class="o">=</span> <span class="n">Moment_Evo_LO</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="n">NFEFF</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">,</span> <span class="n">ConfFlav_xi2</span><span class="p">)</span>
                <span class="n">ConfEv_xi4</span> <span class="o">=</span> <span class="n">Moment_Evo_LO</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">4</span><span class="p">,</span> <span class="n">NFEFF</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">,</span> <span class="n">ConfFlav_xi4</span><span class="p">)</span>
                
            <span class="k">elif</span> <span class="p">(</span><span class="n">p_order</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
                <span class="n">ConfEv</span>     <span class="o">=</span> <span class="n">GPD_Moment_Evo_NLO</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">NFEFF</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi</span><span class="p">,</span> <span class="n">Para_Forward</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">ConfEv_xi2</span> <span class="o">=</span> <span class="n">GPD_Moment_Evo_NLO</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="n">NFEFF</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi</span><span class="p">,</span> <span class="n">Para_xi2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">ConfEv_xi4</span> <span class="o">=</span> <span class="n">GPD_Moment_Evo_NLO</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">4</span><span class="p">,</span> <span class="n">NFEFF</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi</span><span class="p">,</span> <span class="n">Para_xi4</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
                
            <span class="c1"># Inverse transform the evolved moments back to the flavor basis</span>
            <span class="n">ConfFlavEv</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;...ij, ...j-&gt;...i&#39;</span><span class="p">,</span> <span class="n">inv_flav_trans</span><span class="p">,</span> <span class="n">ConfEv</span><span class="p">)</span> <span class="c1">#(N, 5)</span>
            <span class="n">ConfFlavEv_xi2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;...ij, ...j-&gt;...i&#39;</span><span class="p">,</span> <span class="n">inv_flav_trans</span><span class="p">,</span> <span class="n">ConfEv_xi2</span><span class="p">)</span>
            <span class="n">ConfFlavEv_xi4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;...ij, ...j-&gt;...i&#39;</span><span class="p">,</span> <span class="n">inv_flav_trans</span><span class="p">,</span> <span class="n">ConfEv_xi4</span><span class="p">)</span>
            
            <span class="k">return</span> <span class="n">Flv_Intp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;...ij,...j-&gt;...i&#39;</span><span class="p">,</span> <span class="n">ConfWaveConv</span><span class="p">(</span><span class="n">j</span><span class="p">),</span> <span class="n">ConfFlavEv</span><span class="p">)</span> \
                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;...ij,...j-&gt;...i&#39;</span><span class="p">,</span> <span class="n">ConfWaveConv</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="n">ConfFlavEv_xi2</span><span class="p">)</span> \
                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi</span> <span class="o">**</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;...ij,...j-&gt;...i&#39;</span><span class="p">,</span> <span class="n">ConfWaveConv</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">4</span><span class="p">),</span> <span class="n">ConfFlavEv_xi4</span><span class="p">),</span><span class="n">flv</span><span class="p">)</span>
        
        <span class="c1"># Adding a j = 1 term because the contour do not enclose the j = 1 pole which should be the 1th conformal moment.</span>
        <span class="k">def</span> <span class="nf">GPD1</span><span class="p">():</span>
            <span class="n">eps</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">])</span>
            <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">Integrand_Mellin_Barnes</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">eps</span><span class="p">)</span> <span class="c1"># Note the residual theorem gives -(2 np.pi *1j)*1/(2*np.sin((j+1)*np.pi)) with residual (-1) at j=1;</span>
  
        <span class="c1"># Adding a j = 0 term because the contour do not enclose the j = 0 pole which should be the 0th conformal moment.</span>
        <span class="k">def</span> <span class="nf">GPD0</span><span class="p">():</span>
<span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Note: Naively, this function simply returns Integrand_Mellin_Barnes([0.]) like the GPD1() above.</span>
<span class="sd">                  However, the zeroth moment is only defined for valence quark not sea quark or gluon</span>
<span class="sd">                  Thus there will be divergences in moment when j = 0.       </span>
<span class="sd">                  Here we use nan_to_num to set all the divergence to zero, such that the zero moment of the sea quark and gluon do not contribute to GPD.</span>
<span class="sd">                  </span>
<span class="sd">                  The better choice is to model the leading moment terms separately, and fit them to other quantities since those terms are not well constrained by the CFF/TFF anyway.</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="n">j0</span> <span class="o">=</span> <span class="mi">1</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">])</span>
            
            <span class="n">ConfFlav</span>     <span class="o">=</span> <span class="n">Moment_Sum</span><span class="p">(</span><span class="n">j0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">Para_Forward</span><span class="p">)</span>
            <span class="n">ConfFlav_xi2</span> <span class="o">=</span> <span class="n">Moment_Sum</span><span class="p">(</span><span class="n">j0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">Para_xi2</span><span class="p">)</span>
            <span class="n">ConfFlav_xi4</span> <span class="o">=</span> <span class="n">Moment_Sum</span><span class="p">(</span><span class="n">j0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">Para_xi4</span><span class="p">)</span>  

            <span class="n">ConfFlav</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">ConfFlav</span><span class="p">)</span>
            <span class="n">ConfFlav_xi2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">ConfFlav_xi2</span><span class="p">)</span> 
            <span class="n">ConfFlav_xi4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">ConfFlav_xi4</span><span class="p">)</span>  
                
            <span class="k">if</span> <span class="p">(</span><span class="n">p_order</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">ConfEv</span>     <span class="o">=</span> <span class="n">Moment_Evo_LO</span><span class="p">(</span><span class="n">j0</span><span class="p">,</span> <span class="n">NFEFF</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">,</span> <span class="n">ConfFlav</span><span class="p">)</span>
                <span class="n">ConfEv_xi2</span> <span class="o">=</span> <span class="n">Moment_Evo_LO</span><span class="p">(</span><span class="n">j0</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="n">NFEFF</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">,</span> <span class="n">ConfFlav_xi2</span><span class="p">)</span>
                <span class="n">ConfEv_xi4</span> <span class="o">=</span> <span class="n">Moment_Evo_LO</span><span class="p">(</span><span class="n">j0</span><span class="o">+</span><span class="mi">4</span><span class="p">,</span> <span class="n">NFEFF</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">,</span> <span class="n">ConfFlav_xi4</span><span class="p">)</span>
            <span class="c1"># Use tPDF_Moment_Evo_NLO since the off-diagonal piece only contribute for non-zero skewness</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">p_order</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
                <span class="n">ConfEv</span>     <span class="o">=</span> <span class="n">tPDF_Moment_Evo_NLO</span><span class="p">(</span><span class="n">j0</span><span class="p">,</span> <span class="n">NFEFF</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">,</span> <span class="n">ConfFlav</span><span class="p">)</span>
                <span class="n">ConfEv_xi2</span> <span class="o">=</span> <span class="n">tPDF_Moment_Evo_NLO</span><span class="p">(</span><span class="n">j0</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="n">NFEFF</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">,</span> <span class="n">ConfFlav_xi2</span><span class="p">)</span>
                <span class="n">ConfEv_xi4</span> <span class="o">=</span> <span class="n">tPDF_Moment_Evo_NLO</span><span class="p">(</span><span class="n">j0</span><span class="o">+</span><span class="mi">4</span><span class="p">,</span> <span class="n">NFEFF</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">,</span> <span class="n">ConfFlav_xi4</span><span class="p">)</span>
            
            <span class="n">ConfFlavEv</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;...ij, ...j-&gt;...i&#39;</span><span class="p">,</span> <span class="n">inv_flav_trans</span><span class="p">,</span> <span class="n">ConfEv</span><span class="p">)</span> <span class="c1">#(N, 5)</span>
            <span class="n">ConfFlavEv_xi2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;...ij, ...j-&gt;...i&#39;</span><span class="p">,</span> <span class="n">inv_flav_trans</span><span class="p">,</span> <span class="n">ConfEv_xi2</span><span class="p">)</span>
            <span class="n">ConfFlavEv_xi4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;...ij, ...j-&gt;...i&#39;</span><span class="p">,</span> <span class="n">inv_flav_trans</span><span class="p">,</span> <span class="n">ConfEv_xi4</span><span class="p">)</span>
              
            <span class="k">return</span> <span class="n">Flv_Intp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;...ij,...j-&gt;...i&#39;</span><span class="p">,</span> <span class="n">ConfWaveConv</span><span class="p">(</span><span class="n">j0</span><span class="p">),</span> <span class="n">ConfFlavEv</span><span class="p">)</span> \
                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;...ij,...j-&gt;...i&#39;</span><span class="p">,</span> <span class="n">ConfWaveConv</span><span class="p">(</span><span class="n">j0</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="n">ConfFlavEv_xi2</span><span class="p">)</span> \
                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi</span> <span class="o">**</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;...ij,...j-&gt;...i&#39;</span><span class="p">,</span> <span class="n">ConfWaveConv</span><span class="p">(</span><span class="n">j0</span><span class="o">+</span><span class="mi">4</span><span class="p">),</span> <span class="n">ConfFlavEv_xi4</span><span class="p">),</span><span class="n">flv</span><span class="p">)</span>
       
        <span class="n">reJ</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">-</span> <span class="mf">0.5</span>
        <span class="n">Max_imJ</span> <span class="o">=</span> <span class="mi">80</span>
        <span class="k">return</span> <span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">fixed_quadvec</span><span class="p">(</span><span class="k">lambda</span> <span class="n">imJ</span> <span class="p">:</span> <span class="n">Integrand_Mellin_Barnes</span><span class="p">(</span><span class="n">reJ</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span> <span class="n">imJ</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">((</span><span class="n">reJ</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">imJ</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">+</span> <span class="n">Integrand_Mellin_Barnes</span><span class="p">(</span><span class="n">reJ</span> <span class="o">-</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span> <span class="n">imJ</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">((</span><span class="n">reJ</span> <span class="o">-</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">imJ</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="n">Max_imJ</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">300</span><span class="p">))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">GPD1</span><span class="p">())</span>  <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">GPD0</span><span class="p">())</span> </div>

          
<div class="viewcode-block" id="GPDobserv.GFFj0">
<a class="viewcode-back" href="../Observables.html#Observables.GPDobserv.GFFj0">[docs]</a>
    <span class="k">def</span> <span class="nf">GFFj0</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">flv</span><span class="p">,</span> <span class="n">ParaAll</span><span class="p">,</span> <span class="n">p_order</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generalized Form Factors A_{j0}(t) which is the xi^0 term of the nth (n= j+1) Mellin moment of GPD int dx x^j F(x,xi,t) for quark and int dx x^(j-1) F(x,xi,t) for gluon</span>
<span class="sd">            </span>
<span class="sd">            Note for gluon, GPD reduce to x*g(x), not g(x) so the Mellin moment will have a mismatch</span>
<span class="sd">            </span>
<span class="sd">            Only leading order implemented yet NOT well-maintained (TO BE FIXED)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># j, flv both have shape (N)</span>
        <span class="c1"># ParaAll: (N, 3, 5, 1, 5)</span>

<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Para_Forward = ParaAll[0]</span>
<span class="sd">        </span>
<span class="sd">        GFF_trans = np.array([[1,1 - self.p * (-1) ** j,0,0,0],</span>
<span class="sd">                              [0,0,1,1 - self.p * (-1) ** j,0],</span>
<span class="sd">                              [0,0,0,0,(1 - self.p * (-1) ** j)/2]])</span>

<span class="sd">        ConfFlav = np.array( list(map(lambda paraset: Moment_Sum(j, self.t, paraset), Para_Forward)) )</span>

<span class="sd">        if (j == 0):</span>
<span class="sd">            if(self.p == 1):</span>
<span class="sd">                return Flv_Intp( np.array([ConfFlav[0],ConfFlav[2],ConfFlav[4]]) , flv)</span>
<span class="sd">        </span>
<span class="sd">        return Flv_Intp(np.einsum(&#39;...j,j&#39;, GFF_trans, Moment_Evo(j, NFEFF, self.p, self.Q, ConfFlav)), flv)</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">Para_Forward</span> <span class="o">=</span> <span class="n">ParaAll</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:]</span>  <span class="c1"># (N, 5, 1, 5)</span>
        <span class="n">_helper1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                             <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                             <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">]])</span>
        <span class="n">_helper2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                             <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                             <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">]])</span>
        <span class="n">GFF_trans</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;... , ij-&gt;...ij&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="n">j</span><span class="p">,</span> <span class="n">_helper2</span><span class="p">)</span> <span class="o">+</span> <span class="n">_helper1</span>  <span class="c1"># (N, 3, 5)</span>
        <span class="n">ConfFlav</span> <span class="o">=</span> <span class="n">Moment_Sum</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">Para_Forward</span><span class="p">)</span> <span class="c1"># (N, 5)</span>

        <span class="c1"># the result of np.einsum will be (N, 3)</span>
        <span class="c1"># Flv_Intp  result (N)</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="p">((</span><span class="n">j</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">==</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">)</span>

        <span class="n">result</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">Flv_Intp</span><span class="p">(</span><span class="n">ConfFlav</span><span class="p">[</span><span class="n">mask</span><span class="p">][:,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span> <span class="p">]</span> <span class="p">,</span> <span class="n">flv</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="p">)</span> <span class="c1"># (N_mask)</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">p_order</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">ConfEv</span> <span class="o">=</span> <span class="n">Moment_Evo_LO</span><span class="p">(</span><span class="n">j</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">],</span> <span class="n">NFEFF</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">],</span> <span class="n">ConfFlav</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">])</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">p_order</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">ConfEv</span> <span class="o">=</span> <span class="n">tPDF_Moment_Evo_NLO</span><span class="p">(</span><span class="n">j</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">],</span> <span class="n">NFEFF</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">],</span> <span class="n">ConfFlav</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">],</span> <span class="n">muset</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
            
        <span class="c1"># Inverse transform the evolved moments back to the flavor basis</span>
        <span class="n">EvoConfFlav</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;...ij, ...j-&gt;...i&#39;</span><span class="p">,</span> <span class="n">inv_flav_trans</span><span class="p">,</span> <span class="n">ConfEv</span><span class="p">)</span> <span class="c1">#(N, 5)       </span>

        <span class="n">result</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">Flv_Intp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;...ij, ...j-&gt;...i&#39;</span><span class="p">,</span> <span class="n">GFF_trans</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">],</span> <span class="n">EvoConfFlav</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]),</span> <span class="n">flv</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">])</span> <span class="c1"># (N_~mask)</span>
                
        <span class="k">return</span> <span class="n">result</span> <span class="c1">#(N)</span></div>

    
<div class="viewcode-block" id="GPDobserv.CFF">
<a class="viewcode-back" href="../Observables.html#Observables.GPDobserv.CFF">[docs]</a>
    <span class="k">def</span> <span class="nf">CFF</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ParaAll</span><span class="p">,</span> <span class="n">muset</span><span class="p">,</span> <span class="n">p_order</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">flv</span> <span class="o">=</span> <span class="s1">&#39;All&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Charge averged CFF $\mathcal{F}(xi, t) (\mathcal{F} = Q_u^2 F_u + Q_d^2 F_d)$</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            ParaAll = [Para_Forward, Para_xi2, Para_xi4]</span>

<span class="sd">            Para_Forward = [Para_Forward_uV, Para_Forward_ubar, Para_Forward_dV, Para_Forward_dbar, Para_Forward_g]</span>
<span class="sd">            Para_Forward_i: forward parameter sets for valence u quark (uV), sea u quark (ubar), valence d quark (dV), sea d quark (dbar) and gluon (g)</span>
<span class="sd">            Para_xi2 = [Para_xi2_uV, Para_xi2_ubar, Para_xi2_dV, Para_xi2_dbar, Para_xi2_g]</span>
<span class="sd">            Para_xi2_i: xi^2 parameter sets for valence u quark (uV), sea u quark (ubar), valence d quark (dV), sea d quark (dbar) and gluon (g)</span>
<span class="sd">            Para_xi4 = [Para_xi4_uV, Para_xi4_ubar, Para_xi4_dV, Para_xi4_dbar, Para_xi4_g]</span>
<span class="sd">            Para_xi4_i: xi^4 parameter sets for valence u quark (uV), sea u quark (ubar), valence d quark (dV), sea d quark (dbar) and gluon (g)</span>

<span class="sd">        Returns:</span>
<span class="sd">            CFF \mathcal{F}(xi, t) = Q_u^2 F_u + Q_d^2 F_d</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#[Para_Forward, Para_xi2, Para_xi4] = ParaAll  # each (N, 5, 1, 5)</span>
        <span class="n">Para_Forward</span> <span class="o">=</span> <span class="n">ParaAll</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:]</span>  <span class="c1"># each (N, 5, 1, 5)</span>
        <span class="n">Para_xi2</span>     <span class="o">=</span> <span class="n">ParaAll</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:]</span>
        <span class="n">Para_xi4</span>     <span class="o">=</span> <span class="n">ParaAll</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:]</span>

        <span class="k">def</span> <span class="nf">Integrand_Mellin_Barnes_CFF</span><span class="p">(</span><span class="n">j</span><span class="p">:</span> <span class="nb">complex</span><span class="p">):</span>

<span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            ConfFlav = np.array( list(map(lambda paraset: Moment_Sum(j, self.t, paraset), Para_Forward)) )</span>
<span class="sd">            ConfFlav_xi2 = np.array( list(map(lambda paraset: Moment_Sum(j, self.t, paraset), Para_xi2)) )</span>
<span class="sd">            ConfFlav_xi4 = np.array( list(map(lambda paraset: Moment_Sum(j, self.t, paraset), Para_xi4)) )</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="n">ConfFlav</span>     <span class="o">=</span> <span class="n">Moment_Sum</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">Para_Forward</span><span class="p">)</span> <span class="c1">#(N, 5)</span>
            <span class="n">ConfFlav_xi2</span> <span class="o">=</span> <span class="n">Moment_Sum</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">Para_xi2</span><span class="p">)</span>
            <span class="n">ConfFlav_xi4</span> <span class="o">=</span> <span class="n">Moment_Sum</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">Para_xi4</span><span class="p">)</span>

            <span class="c1"># shape (N, 5)</span>

            <span class="n">EvoConf_Wilson</span> <span class="o">=</span> <span class="n">CFF_Evo_LO</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">NFEFF</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">,</span> <span class="n">ConfFlav</span><span class="p">)</span> \
                                <span class="o">+</span> <span class="n">CFF_Evo_LO</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="n">NFEFF</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">,</span> <span class="n">ConfFlav_xi2</span><span class="p">)</span> \
                                    <span class="o">+</span> <span class="n">CFF_Evo_LO</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">4</span><span class="p">,</span> <span class="n">NFEFF</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">,</span> <span class="n">ConfFlav_xi4</span><span class="p">)</span>
            <span class="n">fmask</span> <span class="o">=</span> <span class="n">flvmask</span><span class="p">(</span><span class="n">flv</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;j, ...j&#39;</span><span class="p">,</span> <span class="n">fmask</span><span class="p">,</span> <span class="n">EvoConf_Wilson</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">Integrand_CFF</span><span class="p">(</span><span class="n">imJ</span><span class="p">:</span> <span class="nb">complex</span><span class="p">):</span>
            <span class="c1"># mask = (self.p==1) # assume p can only be either 1 or -1</span>

            <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="n">reJ</span> <span class="o">-</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">imJ</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">Integrand_Mellin_Barnes_CFF</span><span class="p">(</span><span class="n">reJ</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">imJ</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">*=</span> <span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">((</span><span class="n">reJ</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">imJ</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">*=</span> <span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">((</span><span class="n">reJ</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">imJ</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
<span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            if np.ndim(result)&gt;0:</span>
<span class="sd">                result[mask] *= (1j + np.tan((reJ + 1j * imJ) * np.pi / 2))</span>
<span class="sd">                result[~mask] *= (1j - 1/np.tan((reJ + 1j * imJ) * np.pi / 2))</span>
<span class="sd">            else: # scalar</span>
<span class="sd">                if self.p==1:</span>
<span class="sd">                    result *= (1j + np.tan((reJ + 1j * imJ) * np.pi / 2))</span>
<span class="sd">                else:</span>
<span class="sd">                    result *= (1j - 1/np.tan((reJ + 1j * imJ) * np.pi / 2))</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="k">return</span> <span class="n">result</span>

        <span class="c1"># Adding extra j = 0 term for the axial vector CFFs</span>
        <span class="k">def</span> <span class="nf">CFFj0</span><span class="p">():</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">)</span> <span class="o">*</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">Integrand_Mellin_Barnes_CFF</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">]))</span> <span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">result</span>
        
        <span class="c1"># The contour for Mellin-Barnes integral in terms of j not n.</span>
        <span class="n">reJ</span> <span class="o">=</span> <span class="mf">0.3</span> 
        <span class="n">Max_imJ</span> <span class="o">=</span> <span class="mi">150</span> 
        
        <span class="k">return</span> <span class="n">fixed_quadvec</span><span class="p">(</span><span class="k">lambda</span> <span class="n">imJ</span><span class="p">:</span> <span class="n">Integrand_CFF</span><span class="p">(</span><span class="n">imJ</span><span class="p">)</span><span class="o">+</span><span class="n">Integrand_CFF</span><span class="p">(</span><span class="o">-</span><span class="n">imJ</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span>  <span class="n">Max_imJ</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span> <span class="o">+</span> <span class="n">CFFj0</span><span class="p">()</span>

<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        if (self.p == 1):</span>
<span class="sd">            return quad_vec(lambda imJ : self.xi ** (-reJ - 1j * imJ - 1) * (1j + np.tan((reJ + 1j * imJ) * np.pi / 2)) *Integrand_Mellin_Barnes_CFF(reJ + 1j * imJ) / 2, - Max_imJ, + Max_imJ, epsrel = Prec_Goal)[0]</span>
<span class="sd">        </span>
<span class="sd">        if (self.p == -1):</span>
<span class="sd">            return quad_vec(lambda imJ : self.xi ** (-reJ - 1j * imJ - 1) * (1j - 1/np.tan((reJ + 1j * imJ) * np.pi / 2)) *Integrand_Mellin_Barnes_CFF(reJ + 1j * imJ) / 2, - Max_imJ, + Max_imJ, epsrel = Prec_Goal)[0]</span>
<span class="sd">        &#39;&#39;&#39;</span></div>

    
<div class="viewcode-block" id="GPDobserv.TFF">
<a class="viewcode-back" href="../Observables.html#Observables.GPDobserv.TFF">[docs]</a>
    <span class="k">def</span> <span class="nf">TFF</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ParaAll</span><span class="p">,</span> <span class="n">muf</span> <span class="p">,</span> <span class="n">meson</span><span class="p">,</span> <span class="n">p_order</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">flv</span> <span class="o">=</span> <span class="s1">&#39;All&#39;</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;TFF $\mathcal{F}(xi, t) (\mathcal{F}$</span>
<span class="sd">            </span>
<span class="sd">            Args:</span>
<span class="sd">                ParaAll = [Para_Forward, Para_xi2, Para_xi4]</span>

<span class="sd">                Para_Forward = [Para_Forward_uV, Para_Forward_ubar, Para_Forward_dV, Para_Forward_dbar, Para_Forward_g]</span>
<span class="sd">                Para_Forward_i: forward parameter sets for valence u quark (uV), sea u quark (ubar), valence d quark (dV), sea d quark (dbar) and gluon (g)</span>
<span class="sd">                Para_xi2 = [Para_xi2_uV, Para_xi2_ubar, Para_xi2_dV, Para_xi2_dbar, Para_xi2_g]</span>
<span class="sd">                Para_xi2_i: xi^2 parameter sets for valence u quark (uV), sea u quark (ubar), valence d quark (dV), sea d quark (dbar) and gluon (g)</span>
<span class="sd">                Para_xi4 = [Para_xi4_uV, Para_xi4_ubar, Para_xi4_dV, Para_xi4_dbar, Para_xi4_g]</span>
<span class="sd">                Para_xi4_i: xi^4 parameter sets for valence u quark (uV), sea u quark (ubar), valence d quark (dV), sea d quark (dbar) and gluon (g)</span>
<span class="sd">                </span>
<span class="sd">                meson = [1 for rho, 2 for phi, 3 for jpsi]</span>
<span class="sd">                </span>
<span class="sd">                p_order: 1 for leading-order evolution (default); 2 for next-to-leading-order evolution ; higher order not implemented yet</span>
<span class="sd">                </span>
<span class="sd">                (flv = &quot;u&quot;, &quot;d&quot;, &quot;g&quot;, &quot;All&quot; or &quot;q&quot;)</span>
<span class="sd">                </span>
<span class="sd">            Returns:</span>
<span class="sd">                TFF \mathcal{F}(xi, t)</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">p_order</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">TFFNLO</span><span class="p">(</span><span class="n">ParaAll</span><span class="p">,</span> <span class="n">muf</span><span class="p">,</span> <span class="n">meson</span><span class="p">,</span> <span class="n">flv</span><span class="p">)</span>
            
            <span class="c1">#[Para_Forward, Para_xi2, Para_xi4] = ParaAll  # each (N, 5, 1, 5)</span>
            <span class="n">Para_Forward</span> <span class="o">=</span> <span class="n">ParaAll</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:]</span>  <span class="c1"># each (N, 5, 1, 5)</span>
            <span class="n">Para_xi2</span>     <span class="o">=</span> <span class="n">ParaAll</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:]</span>
            <span class="n">Para_xi4</span>     <span class="o">=</span> <span class="n">ParaAll</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:]</span>

            <span class="k">def</span> <span class="nf">Integrand_Mellin_Barnes_TFF</span><span class="p">(</span><span class="n">j</span><span class="p">:</span> <span class="nb">complex</span><span class="p">):</span>

                <span class="n">ConfFlav</span>     <span class="o">=</span> <span class="n">Moment_Sum</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">Para_Forward</span><span class="p">)</span> <span class="c1">#(N, 5)</span>
                <span class="n">ConfFlav_xi2</span> <span class="o">=</span> <span class="n">Moment_Sum</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">Para_xi2</span><span class="p">)</span>
                <span class="n">ConfFlav_xi4</span> <span class="o">=</span> <span class="n">Moment_Sum</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">Para_xi4</span><span class="p">)</span>
                
                <span class="n">EvoConf_Wilson</span> <span class="o">=</span> <span class="p">(</span><span class="n">TFF_Evo_LO</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">NFEFF</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">,</span> <span class="n">ConfFlav</span><span class="p">,</span> <span class="n">meson</span><span class="p">)</span> \
                                    <span class="o">+</span> <span class="n">TFF_Evo_LO</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="n">NFEFF</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">,</span> <span class="n">ConfFlav_xi2</span><span class="p">,</span> <span class="n">meson</span><span class="p">)</span> \
                                        <span class="o">+</span> <span class="n">TFF_Evo_LO</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">4</span><span class="p">,</span> <span class="n">NFEFF</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">,</span> <span class="n">ConfFlav_xi4</span><span class="p">,</span> <span class="n">meson</span><span class="p">))</span>
                
                <span class="n">fmask</span> <span class="o">=</span> <span class="n">flvmask</span><span class="p">(</span><span class="n">flv</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;j, ...j&#39;</span><span class="p">,</span> <span class="n">fmask</span><span class="p">,</span> <span class="n">EvoConf_Wilson</span><span class="p">)</span>  
         
            <span class="k">def</span> <span class="nf">Integrand_TFF</span><span class="p">(</span><span class="n">imJ</span><span class="p">:</span> <span class="nb">complex</span><span class="p">):</span>
                <span class="c1"># mask = (self.p==1) # assume p can only be either 1 or -1</span>

                <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="n">reJ</span> <span class="o">-</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">imJ</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">Integrand_Mellin_Barnes_TFF</span><span class="p">(</span><span class="n">reJ</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">imJ</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">*=</span> <span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">((</span><span class="n">reJ</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">imJ</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">*=</span> <span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">((</span><span class="n">reJ</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">imJ</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
<span class="w">                </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">                if np.ndim(result)&gt;0:</span>
<span class="sd">                    result[mask] *= (1j + np.tan((reJ + 1j * imJ) * np.pi / 2))</span>
<span class="sd">                    result[~mask] *= (1j - 1/np.tan((reJ + 1j * imJ) * np.pi / 2))</span>
<span class="sd">                else: # scalar</span>
<span class="sd">                    if self.p==1:</span>
<span class="sd">                        result *= (1j + np.tan((reJ + 1j * imJ) * np.pi / 2))</span>
<span class="sd">                    else:</span>
<span class="sd">                        result *= (1j - 1/np.tan((reJ + 1j * imJ) * np.pi / 2))</span>
<span class="sd">                &#39;&#39;&#39;</span>
                <span class="k">return</span> <span class="n">result</span>

            <span class="c1"># Adding extra j = 0 term for the axial vector CFFs</span>
            <span class="k">def</span> <span class="nf">TFFj0</span><span class="p">():</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">)</span> <span class="o">*</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">Integrand_Mellin_Barnes_TFF</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

                <span class="k">return</span> <span class="n">result</span>
            
            <span class="c1"># The contour for Mellin-Barnes integral in terms of j not n.</span>
            <span class="n">reJ</span> <span class="o">=</span> <span class="mf">0.5</span> 
            <span class="n">Max_imJ</span> <span class="o">=</span> <span class="mi">120</span> 
            
            <span class="k">return</span> <span class="n">fixed_quadvec</span><span class="p">(</span><span class="k">lambda</span> <span class="n">imJ</span><span class="p">:</span> <span class="n">Integrand_TFF</span><span class="p">(</span><span class="n">imJ</span><span class="p">)</span><span class="o">+</span><span class="n">Integrand_TFF</span><span class="p">(</span><span class="o">-</span><span class="n">imJ</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span>  <span class="n">Max_imJ</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span> <span class="o">+</span> <span class="n">TFFj0</span><span class="p">()</span>
        
            <span class="c1">#return fixed_quad(Integrand_TFF, - Max_imJ, + Max_imJ, n=1000)[0] + TFFj0()</span>

<span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            if (self.p == 1):</span>
<span class="sd">                return quad_vec(lambda imJ : self.xi ** (-reJ - 1j * imJ - 1) * (1j + np.tan((reJ + 1j * imJ) * np.pi / 2)) *Integrand_Mellin_Barnes_CFF(reJ + 1j * imJ) / 2, - Max_imJ, + Max_imJ, epsrel = Prec_Goal)[0]</span>
<span class="sd">            </span>
<span class="sd">            if (self.p == -1):</span>
<span class="sd">                return quad_vec(lambda imJ : self.xi ** (-reJ - 1j * imJ - 1) * (1j - 1/np.tan((reJ + 1j * imJ) * np.pi / 2)) *Integrand_Mellin_Barnes_CFF(reJ + 1j * imJ) / 2, - Max_imJ, + Max_imJ, epsrel = Prec_Goal)[0]</span>
<span class="sd">            &#39;&#39;&#39;</span></div>


    <span class="c1"># A separate function for next-to-leading order TFF, it can be called directly or with TFF() by setting p_order = 2 </span>
<div class="viewcode-block" id="GPDobserv.TFFNLO">
<a class="viewcode-back" href="../Observables.html#Observables.GPDobserv.TFFNLO">[docs]</a>
    <span class="k">def</span> <span class="nf">TFFNLO</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ParaAll</span><span class="p">,</span> <span class="n">muf</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">meson</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">flv</span> <span class="o">=</span> <span class="s1">&#39;All&#39;</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;TFF $\mathcal{F}(xi, t) (\mathcal{F}$</span>
<span class="sd">            </span>
<span class="sd">            Args:</span>
<span class="sd">                ParaAll = [Para_Forward, Para_xi2, Para_xi4]</span>

<span class="sd">                Para_Forward = [Para_Forward_uV, Para_Forward_ubar, Para_Forward_dV, Para_Forward_dbar, Para_Forward_g]</span>
<span class="sd">                Para_Forward_i: forward parameter sets for valence u quark (uV), sea u quark (ubar), valence d quark (dV), sea d quark (dbar) and gluon (g)</span>
<span class="sd">                Para_xi2 = [Para_xi2_uV, Para_xi2_ubar, Para_xi2_dV, Para_xi2_dbar, Para_xi2_g]</span>
<span class="sd">                Para_xi2_i: xi^2 parameter sets for valence u quark (uV), sea u quark (ubar), valence d quark (dV), sea d quark (dbar) and gluon (g)</span>
<span class="sd">                Para_xi4 = [Para_xi4_uV, Para_xi4_ubar, Para_xi4_dV, Para_xi4_dbar, Para_xi4_g]</span>
<span class="sd">                Para_xi4_i: xi^4 parameter sets for valence u quark (uV), sea u quark (ubar), valence d quark (dV), sea d quark (dbar) and gluon (g)</span>
<span class="sd">                </span>
<span class="sd">                meson = [1 for rho, 2 for phi, 3 for jpsi]</span>
<span class="sd">                                </span>
<span class="sd">                muset = offset of scale mu to study the scale dependence of the results</span>
<span class="sd">                </span>
<span class="sd">                (flv = &quot;u&quot;, &quot;d&quot;, &quot;g&quot;, &quot;All&quot; or &quot;q&quot;)</span>
<span class="sd">                </span>
<span class="sd">            Returns:</span>
<span class="sd">                TFF \mathcal{F}(xi, t)</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="c1">#[Para_Forward, Para_xi2, Para_xi4] = ParaAll  # each (N, 5, 1, 5)</span>
            <span class="n">Para_Forward</span> <span class="o">=</span> <span class="n">ParaAll</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:]</span>  <span class="c1"># each (N, 5, 1, 5)</span>
            <span class="n">Para_xi2</span>     <span class="o">=</span> <span class="n">ParaAll</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:]</span>
            <span class="n">Para_xi4</span>     <span class="o">=</span> <span class="n">ParaAll</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:]</span>
<span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            # Removing xi^4 terms</span>
<span class="sd">            Para_xi4     = ParaAll[..., 2, :, :, :]</span>
<span class="sd">            &#39;&#39;&#39;</span>

            <span class="c1"># The contour for Mellin-Barnes integral in terms of j not n.</span>
            <span class="n">reJ</span> <span class="o">=</span> <span class="n">Mellin_Barnes_intercept</span> 
            <span class="n">Max_imJ</span> <span class="o">=</span> <span class="n">Mellin_Barnes_cutoff</span>
            
            <span class="k">def</span> <span class="nf">Integrand_Mellin_Barnes_TFF</span><span class="p">(</span><span class="n">j</span><span class="p">:</span> <span class="nb">complex</span><span class="p">):</span>
                <span class="c1"># j is a scalar</span>

<span class="w">                </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">                ConfFlav = np.array( list(map(lambda paraset: Moment_Sum(j, self.t, paraset), Para_Forward)) )</span>
<span class="sd">                ConfFlav_xi2 = np.array( list(map(lambda paraset: Moment_Sum(j, self.t, paraset), Para_xi2)) )</span>
<span class="sd">                ConfFlav_xi4 = np.array( list(map(lambda paraset: Moment_Sum(j, self.t, paraset), Para_xi4)) )</span>
<span class="sd">                &#39;&#39;&#39;</span>
                <span class="n">ConfFlav</span>     <span class="o">=</span> <span class="n">Moment_Sum</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">Para_Forward</span><span class="p">)</span> <span class="c1">#(N, 5)</span>
                <span class="n">ConfFlav_xi2</span> <span class="o">=</span> <span class="n">Moment_Sum</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">Para_xi2</span><span class="p">)</span>
                <span class="n">ConfFlav_xi4</span> <span class="o">=</span> <span class="n">Moment_Sum</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">Para_xi4</span><span class="p">)</span>
<span class="w">                </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">                # Removing xi^4 terms</span>
<span class="sd">                ConfFlav_xi4 = Moment_Sum(j, self.t, Para_xi4)</span>
<span class="sd">                &#39;&#39;&#39;</span>

                <span class="c1"># shape (N, 5)</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                # Removing xi^4 terms</span>
<span class="sd">                EvoConf_Wilson = (CWilson(j) * Moment_Evo(j, NFEFF, self.p, self.Q, ConfFlav) \</span>
<span class="sd">                                    + CWilson(j+2) * Moment_Evo(j+2, NFEFF, self.p, self.Q, ConfFlav_xi2) \</span>
<span class="sd">                                    + CWilson(j+4) * Moment_Evo(j+4, NFEFF, self.p, self.Q, ConfFlav_xi4))</span>
<span class="sd">                &quot;&quot;&quot;</span>
                <span class="n">EvoConf_Wilson</span> <span class="o">=</span> <span class="p">(</span><span class="n">TFF_Evo_NLO_evWC</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">NFEFF</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">,</span> <span class="n">ConfFlav</span><span class="p">,</span> <span class="n">meson</span><span class="p">,</span> <span class="n">muf</span><span class="p">)</span> \
                                 <span class="o">+</span>  <span class="n">TFF_Evo_NLO_evWC</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="n">NFEFF</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">,</span> <span class="n">ConfFlav_xi2</span><span class="p">,</span> <span class="n">meson</span><span class="p">,</span> <span class="n">muf</span><span class="p">)</span> \
                                 <span class="o">+</span>  <span class="n">TFF_Evo_NLO_evWC</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">4</span><span class="p">,</span> <span class="n">NFEFF</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">,</span> <span class="n">ConfFlav_xi4</span><span class="p">,</span> <span class="n">meson</span><span class="p">,</span> <span class="n">muf</span><span class="p">))</span>
<span class="w">                </span>
<span class="w">                </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">                if(meson == 1):</span>
<span class="sd">                    return np.einsum(&#39;j, ...j&#39;, TFF_rho_trans, EvoConf_Wilson)                </span>
<span class="sd">                if(meson== 2):</span>
<span class="sd">                    return np.einsum(&#39;j, ...j&#39;, TFF_phi_trans, EvoConf_Wilson)                </span>
<span class="sd">                if(meson == 3):</span>
<span class="sd">                    return np.einsum(&#39;j, ...j&#39;, TFF_jpsi_trans, EvoConf_Wilson)</span>
<span class="sd">                &#39;&#39;&#39;</span>                
                <span class="n">fmask</span> <span class="o">=</span> <span class="n">flvmask</span><span class="p">(</span><span class="n">flv</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;j, ...j&#39;</span><span class="p">,</span> <span class="n">fmask</span><span class="p">,</span> <span class="n">EvoConf_Wilson</span><span class="p">)</span>
            
            <span class="k">def</span> <span class="nf">tan_factor</span><span class="p">(</span><span class="n">j</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span>
                    <span class="k">return</span>  <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">xi</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span>  <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">xi</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
            
            <span class="n">eps</span><span class="o">=</span> <span class="mf">10.</span> <span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">)</span>            
            <span class="c1"># adding back the j=0 contribution            </span>
            <span class="k">def</span> <span class="nf">TFFj0</span><span class="p">():</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                    <span class="k">return</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">*</span> <span class="n">Integrand_Mellin_Barnes_TFF</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="o">+</span><span class="n">eps</span><span class="p">]))</span> <span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># the last factor of 2 is the residual of -1/(2j)*np.cot(j * np.pi / 2) at j=0</span>
            
            <span class="n">reJ</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="mf">0.8</span>
            
            <span class="n">Max_imJ</span> <span class="o">=</span> <span class="mi">150</span>
            
            <span class="k">return</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">fixed_quadvec</span><span class="p">(</span><span class="k">lambda</span> <span class="n">imJ</span><span class="p">:</span> <span class="n">tan_factor</span><span class="p">(</span><span class="n">reJ</span><span class="o">+</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">imJ</span><span class="p">)</span><span class="o">*</span><span class="n">Integrand_Mellin_Barnes_TFF</span><span class="p">(</span><span class="n">reJ</span><span class="o">+</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">imJ</span><span class="p">)</span><span class="o">+</span><span class="n">tan_factor</span><span class="p">(</span><span class="n">reJ</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">imJ</span><span class="p">)</span><span class="o">*</span><span class="n">Integrand_Mellin_Barnes_TFF</span><span class="p">(</span><span class="n">reJ</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">imJ</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Max_imJ</span><span class="p">,</span><span class="n">n</span> <span class="o">=</span> <span class="mi">300</span><span class="p">)</span> <span class="o">+</span> <span class="n">TFFj0</span><span class="p">()</span></div>


    <span class="c1"># A different function for next-to-leading order TFF using evolved moment method, it can be checked that it generate the same results as the evolve Wilson coefficient method</span>
<div class="viewcode-block" id="GPDobserv.TFFNLO_evMom">
<a class="viewcode-back" href="../Observables.html#Observables.GPDobserv.TFFNLO_evMom">[docs]</a>
    <span class="k">def</span> <span class="nf">TFFNLO_evMom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ParaAll</span><span class="p">,</span> <span class="n">muf</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">meson</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">flv</span> <span class="o">=</span> <span class="s1">&#39;All&#39;</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;NLOTFF $\mathcal{F}(xi, t) (\mathcal{F}) $</span>
<span class="sd">            </span>
<span class="sd">            Args:</span>
<span class="sd">                ParaAll = [Para_Forward, Para_xi2, Para_xi4]</span>

<span class="sd">                Para_Forward = [Para_Forward_uV, Para_Forward_ubar, Para_Forward_dV, Para_Forward_dbar, Para_Forward_g]</span>
<span class="sd">                Para_Forward_i: forward parameter sets for valence u quark (uV), sea u quark (ubar), valence d quark (dV), sea d quark (dbar) and gluon (g)</span>
<span class="sd">                Para_xi2 = [Para_xi2_uV, Para_xi2_ubar, Para_xi2_dV, Para_xi2_dbar, Para_xi2_g]</span>
<span class="sd">                Para_xi2_i: xi^2 parameter sets for valence u quark (uV), sea u quark (ubar), valence d quark (dV), sea d quark (dbar) and gluon (g)</span>
<span class="sd">                Para_xi4 = [Para_xi4_uV, Para_xi4_ubar, Para_xi4_dV, Para_xi4_dbar, Para_xi4_g]</span>
<span class="sd">                Para_xi4_i: xi^4 parameter sets for valence u quark (uV), sea u quark (ubar), valence d quark (dV), sea d quark (dbar) and gluon (g)</span>
<span class="sd">                </span>
<span class="sd">                meson = [1 for rho, 2 for phi, 3 for jpsi]</span>
<span class="sd">                </span>
<span class="sd">                muset = offset of scale mu to study the scale dependence of the results</span>
<span class="sd">                </span>
<span class="sd">                (flv = &quot;u&quot;, &quot;d&quot;, &quot;g&quot;, &quot;All&quot; or &quot;q&quot;)</span>
<span class="sd">                </span>
<span class="sd">            Returns:</span>
<span class="sd">                TFF \mathcal{F}(xi, t)</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="c1">#[Para_Forward, Para_xi2, Para_xi4] = ParaAll  # each (N, 5, 1, 5)</span>
            <span class="n">Para_Forward</span> <span class="o">=</span> <span class="n">ParaAll</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:]</span>  <span class="c1"># each (N, 5, 1, 5)</span>
            <span class="n">Para_xi2</span>     <span class="o">=</span> <span class="n">ParaAll</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:]</span>
            <span class="n">Para_xi4</span>     <span class="o">=</span> <span class="n">ParaAll</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:]</span>
<span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            # Removing xi^4 terms</span>
<span class="sd">            Para_xi4     = ParaAll[..., 2, :, :, :]</span>
<span class="sd">            &#39;&#39;&#39;</span>

            <span class="c1"># The contour for Mellin-Barnes integral in terms of j not n.</span>
            <span class="n">reJ</span> <span class="o">=</span> <span class="n">Mellin_Barnes_intercept</span> 
            <span class="n">Max_imJ</span> <span class="o">=</span> <span class="n">Mellin_Barnes_cutoff</span>
            
            <span class="k">def</span> <span class="nf">Integrand_Mellin_Barnes_TFF</span><span class="p">(</span><span class="n">j</span><span class="p">:</span> <span class="nb">complex</span><span class="p">):</span>
                
                <span class="n">EvoConf_Wilson</span> <span class="o">=</span> <span class="p">(</span><span class="n">TFF_Evo_NLO_evMOM</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">NFEFF</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi</span><span class="p">,</span> <span class="n">Para_Forward</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">meson</span><span class="p">,</span> <span class="n">muf</span><span class="p">)</span> \
                                          <span class="o">+</span>  <span class="n">TFF_Evo_NLO_evMOM</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="n">NFEFF</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi</span><span class="p">,</span> <span class="n">Para_xi2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">meson</span><span class="p">,</span> <span class="n">muf</span><span class="p">)</span> \
                                              <span class="o">+</span>  <span class="n">TFF_Evo_NLO_evMOM</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">4</span><span class="p">,</span> <span class="n">NFEFF</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi</span><span class="p">,</span> <span class="n">Para_xi4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">meson</span><span class="p">,</span> <span class="n">muf</span><span class="p">))</span>
<span class="w">                </span>
<span class="w">                </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">                if(meson == 1):</span>
<span class="sd">                    return np.einsum(&#39;j, ...j&#39;, TFF_rho_trans, EvoConf_Wilson)                </span>
<span class="sd">                if(meson== 2):</span>
<span class="sd">                    return np.einsum(&#39;j, ...j&#39;, TFF_phi_trans, EvoConf_Wilson)                </span>
<span class="sd">                if(meson == 3):</span>
<span class="sd">                    return np.einsum(&#39;j, ...j&#39;, TFF_jpsi_trans, EvoConf_Wilson)                </span>
<span class="sd">                &#39;&#39;&#39;</span>
                <span class="n">fmask</span> <span class="o">=</span> <span class="n">flvmask</span><span class="p">(</span><span class="n">flv</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;j, ...j&#39;</span><span class="p">,</span> <span class="n">fmask</span><span class="p">,</span> <span class="n">EvoConf_Wilson</span><span class="p">)</span>
            
            <span class="k">def</span> <span class="nf">tan_factor</span><span class="p">(</span><span class="n">j</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span>
                    <span class="k">return</span>  <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">xi</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span>  <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">xi</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
            
            <span class="n">eps</span><span class="o">=</span> <span class="mf">10.</span> <span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">)</span>
            
            <span class="c1"># adding back the j=0 contribution            </span>
            <span class="k">def</span> <span class="nf">TFFj0</span><span class="p">():</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                    <span class="k">return</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">*</span> <span class="n">Integrand_Mellin_Barnes_TFF</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="o">+</span><span class="n">eps</span><span class="p">]))</span> <span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># the last factor of 2 is the residual of -1/(2j)*np.cot(j * np.pi / 2) at j=0</span>
            
            <span class="c1">#for moment evolution, the j=1 pole is also missed because we choose 1&lt;cj&lt;2.</span>
            <span class="k">def</span> <span class="nf">TFFj1</span><span class="p">():</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span> <span class="mf">2.</span><span class="p">)</span> <span class="o">*</span> <span class="n">Integrand_Mellin_Barnes_TFF</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.</span><span class="o">+</span><span class="n">eps</span><span class="p">]))</span> <span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># the last factor of 2 is the residual of 1/(2j)*np.tan(j * np.pi / 2) at j=1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="mi">0</span>            
            
            <span class="n">reJ</span> <span class="o">=</span> <span class="mf">2.</span> <span class="o">-</span> <span class="mf">0.5</span>
        
            <span class="n">Max_imJ</span> <span class="o">=</span> <span class="mi">150</span>

            <span class="k">return</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">fixed_quadvec</span><span class="p">(</span><span class="k">lambda</span> <span class="n">imJ</span><span class="p">:</span> <span class="n">tan_factor</span><span class="p">(</span><span class="n">reJ</span><span class="o">+</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">imJ</span><span class="p">)</span><span class="o">*</span><span class="n">Integrand_Mellin_Barnes_TFF</span><span class="p">(</span><span class="n">reJ</span><span class="o">+</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">imJ</span><span class="p">)</span><span class="o">+</span><span class="n">tan_factor</span><span class="p">(</span><span class="n">reJ</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">imJ</span><span class="p">)</span><span class="o">*</span><span class="n">Integrand_Mellin_Barnes_TFF</span><span class="p">(</span><span class="n">reJ</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">imJ</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Max_imJ</span><span class="p">,</span><span class="n">n</span> <span class="o">=</span> <span class="mi">400</span><span class="p">)</span> <span class="o">+</span> <span class="n">TFFj0</span><span class="p">()</span> <span class="o">+</span> <span class="n">TFFj1</span><span class="p">()</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Yuxun Guo. et. al..</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>